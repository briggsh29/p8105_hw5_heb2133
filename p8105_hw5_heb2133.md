Homework 5
================

``` r
library(tidyverse)
```

    ## -- Attaching packages -------------------------- tidyverse 1.3.0 --

    ## v ggplot2 3.3.2     v purrr   0.3.4
    ## v tibble  3.0.3     v dplyr   1.0.2
    ## v tidyr   1.1.2     v stringr 1.4.0
    ## v readr   1.3.1     v forcats 0.5.0

    ## -- Conflicts ----------------------------- tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
knitr::opts_chunk$set(
  fig.width = 6, 
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis", 
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

Read in data

``` r
homicide_df = 
  read.csv("./data/homicide-data.csv") %>% 
  janitor::clean_names()
```

This dataset is from the Washington Post, which mapped over 52,000
homicides and any resulting arrests within 50 of the largest cities in
America. Key variables in this dataset include Report date; Victim name,
age, and sex; City; State; Latitude and longitude; and the Disposition.
There are 52179 rows and 12 columns in this raw dataset.

Add variables “city\_state”, “resolved”, and summarize total homicides
and total unresolved homicides within cities.

``` r
homicide_df =
  homicide_df %>% 
  unite("city_state", city:state, sep = "_", remove = TRUE) %>% 
  mutate(
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved")
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL")

aggregate_df = 
  homicide_df %>% 
  group_by(city_state) %>% 
  summarise(
    total_hom = n(),
    unsolved_hom = sum(resolved == "unsolved")
  )
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

For Baltimore\_MD, estimate proportion of homicides that are unsolved.

``` r
balt_prop = 
  prop.test(
    aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(unsolved_hom), 
    aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(total_hom)) %>% 
  broom::tidy()

balt_prop %>% pull(estimate)
```

    ##         p 
    ## 0.6455607

``` r
balt_prop %>% pull(conf.low) 
```

    ## [1] 0.6275625

``` r
balt_prop %>% pull(conf.high)
```

    ## [1] 0.6631599

Run prop.test for each city, extract the proportion and CIs for each:

``` r
aggregate_df %>%
  mutate(
    prop_tests = map2(.x = unsolved_hom, .y = total_hom, ~prop.test(x = .x, n = .y)), 
    tidy_tests = map(.x = prop_tests, ~broom::tidy(.x))
  )
```

    ## # A tibble: 50 x 5
    ##    city_state     total_hom unsolved_hom prop_tests tidy_tests      
    ##    <chr>              <int>        <int> <list>     <list>          
    ##  1 Albuquerque_NM       378          146 <htest>    <tibble [1 x 8]>
    ##  2 Atlanta_GA           973          373 <htest>    <tibble [1 x 8]>
    ##  3 Baltimore_MD        2827         1825 <htest>    <tibble [1 x 8]>
    ##  4 Baton Rouge_LA       424          196 <htest>    <tibble [1 x 8]>
    ##  5 Birmingham_AL        800          347 <htest>    <tibble [1 x 8]>
    ##  6 Boston_MA            614          310 <htest>    <tibble [1 x 8]>
    ##  7 Buffalo_NY           521          319 <htest>    <tibble [1 x 8]>
    ##  8 Charlotte_NC         687          206 <htest>    <tibble [1 x 8]>
    ##  9 Chicago_IL          5535         4073 <htest>    <tibble [1 x 8]>
    ## 10 Cincinnati_OH        694          309 <htest>    <tibble [1 x 8]>
    ## # ... with 40 more rows

Create a plot that shows the estimates and CIs for each city – check out
geom\_errorbar for a way to add error bars based on the upper and lower
limits. Organize cities according to the proportion of unsolved
homicides
